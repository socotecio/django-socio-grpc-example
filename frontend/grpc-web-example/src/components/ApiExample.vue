<script setup>
import { ref, onMounted } from 'vue'
import { AuthorController } from '../gen/example_bib_app_connect'

import { createPromiseClient } from "@connectrpc/connect";
import { createGrpcWebTransport } from "@connectrpc/connect-web";

// The transport defines what type of endpoint we're hitting.
// In our example we'll be communicating with a gRPC-web endpoint.
// See https://connectrpc.com/docs/web/choosing-a-protocol
const transport = createGrpcWebTransport({
  baseUrl: "http://localhost:9991",
});

// Here we make the client itself, combining the service
// definition with the transport.
// See https://connectrpc.com/docs/web/using-clients
const authorClient = createPromiseClient(AuthorController, transport);

let items = ref([])

onMounted(async() => {
  const res = await authorClient.list({})
  console.log(res)
  items.value = res.results
})

async function createAuthor() {
  const res = await authorClient.create({
    nameFirst: "TestFirst",
    nameLast: "TestLast",
    birthDate: "2000-01-01"    
  })
  console.log(res)
}

</script>

<template>
  <div class="greetings">
    <h1 class="green">gRPC Web Example</h1>
    <button @click="createAuthor">Create element with grpc-web</button>
    <h3>Elements existings: </h3>
    <ul>
      <li v-for="item in items">{{ item.nameFirst }} {{ item.nameLast }} {{ item.birthDate }}</li>
    </ul>
  </div>
</template>


